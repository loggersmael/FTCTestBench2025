var rt=Object.defineProperty;var it=e=>{throw TypeError(e)};var ot=(e,t,i)=>t in e?rt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var u=(e,t,i)=>ot(e,typeof t!="symbol"?t+"":t,i),lt=(e,t,i)=>t.has(e)||it("Cannot "+i);var s=(e,t,i)=>(lt(e,t,"read from private field"),i?i.call(e):t.get(e)),r=(e,t,i)=>t.has(e)?it("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i);import{a9 as l,g as o,G as h,d as M}from"./0-szhb9U.js";import{p as a}from"./BzflOjYQ.js";var f,y;class ht{constructor(){r(this,f,l(a([])));r(this,y,l(null));u(this,"lastTimestamp",0)}get gamepads(){return o(s(this,f))}set gamepads(t){h(s(this,f),a(t))}get current(){return o(s(this,y))}set current(t){h(s(this,y),a(t))}updateGamepads(){this.gamepads=navigator.getGamepads?Array.from(navigator.getGamepads()).filter(t=>t):[],this.gamepads.length?(this.current=this.gamepads[0],this.lastTimestamp<this.current.timestamp&&(console.log("Update: ",this.current),this.lastTimestamp=this.current.timestamp)):this.current=null}getPS4ButtonLabel(t){return{0:"✕",1:"◯",2:"◻",3:"△",4:"L1",5:"R1",6:"L2",7:"R2",8:"Share",9:"Options",10:"L3",11:"R3",12:"D-Pad Up",13:"D-Pad Down",14:"D-Pad Left",15:"D-Pad Right",16:"PS",17:"Touchpad"}[t]||`B${t}`}}f=new WeakMap,y=new WeakMap;const dt={lines:[],rectangles:[],circles:[]};var S;class gt{constructor(){u(this,"socket",null);u(this,"url",`ws://${window.location.hostname}:8002`);u(this,"messageHandlers",{});u(this,"reconnectInterval",1e3);u(this,"messageQueue",[]);r(this,S,l("closed"));this.messageQueue=[],this.messageHandlers={}}get state(){return o(s(this,S))}set state(t){h(s(this,S),a(t))}init(){return console.log("ran init"),new Promise((t,i)=>{this.socket||(this.socket=new WebSocket(this.url),this.socket.onopen=()=>{this.state="opened",console.log("Connected to WebSocket."),t(),this.flushQueue()},this.socket.onmessage=n=>{const g=JSON.parse(n.data),p=g.kind;p!="time"&&console.log(g),this.handleMessage(p,g)},this.socket.onerror=n=>{console.error("WebSocket error:",n),i(n)},this.socket.onclose=()=>{this.state="closed",console.log("WebSocket closed. Attempting to reconnect..."),setTimeout(async()=>await this.reconnect(),this.reconnectInterval)})})}async reconnect(){this.state=="closed"&&(console.log("Reconnecting..."),this.socket=null,await this.init())}sendMessage(t){this.socket&&this.socket.readyState===WebSocket.OPEN?this.socket.send(JSON.stringify(t)):(console.warn("WebSocket not open. Queuing message."),this.messageQueue.push(JSON.stringify(t)))}flushQueue(){var t;for(;this.messageQueue.length>0&&((t=this.socket)==null?void 0:t.readyState)===WebSocket.OPEN;)this.socket.send(this.messageQueue.shift())}handleMessage(t,i){const n=this.messageHandlers[t];n?n(i):console.warn(`No handler for message kind: ${t}`)}addMessageHandler(t,i){this.messageHandlers[t]=i}removeMessageHandler(t){delete this.messageHandlers[t]}}S=new WeakMap;var w,O,N,R,A,k,P,E,F,I,L,H,T,b,G,Y,_,K,q,U,z,V,W,C,x,D,J;class ct{constructor(){r(this,w,l(a([])));r(this,O,l(!1));r(this,N,l(!1));r(this,R,l(""));r(this,A,l(a([])));r(this,k,l("$Stop$Robot$"));r(this,P,l("stopped"));r(this,E,l(a([])));r(this,F,l(a(dt)));r(this,I,l(a({})));r(this,L,l(2));r(this,H,l(!1));r(this,T,l(!1));r(this,b,l(!1));r(this,G,l(a([])));r(this,Y,M(()=>this.history.length>0));r(this,_,M(()=>{var t;return((t=this.history.at(0))==null?void 0:t.timestamp)||0}));r(this,K,M(()=>{var t;return((t=this.history.at(this.history.length-1))==null?void 0:t.timestamp)||0}));r(this,q,M(()=>this.endTimestamp-this.startTimestamp));r(this,U,l(0));r(this,z,M(()=>{var t=0,i=0;for(const n of this.history){if(n.timestamp<=this.timestamp+this.startTimestamp)t=i;else return this.history.at(t);i++}return this.history.at(this.history.length-1)||null}));r(this,V,l(a([])));r(this,W,l(a(new Map)));r(this,C,l(a({})));r(this,x,l(""));r(this,D,l("NORMAL"));r(this,J,l(-1))}get plugins(){return o(s(this,w))}set plugins(t){h(s(this,w),a(t))}get showSettings(){return o(s(this,O))}set showSettings(t){h(s(this,O),a(t))}get showEdit(){return o(s(this,N))}set showEdit(t){h(s(this,N),a(t))}get time(){return o(s(this,R))}set time(t){h(s(this,R),a(t))}get opModes(){return o(s(this,A))}set opModes(t){h(s(this,A),a(t))}get activeOpMode(){return o(s(this,k))}set activeOpMode(t){h(s(this,k),a(t))}get activeOpModeStatus(){return o(s(this,P))}set activeOpModeStatus(t){h(s(this,P),a(t))}get telemetry(){return o(s(this,E))}set telemetry(t){h(s(this,E),a(t))}get canvas(){return o(s(this,F))}set canvas(t){h(s(this,F),a(t))}get graphs(){return o(s(this,I))}set graphs(t){h(s(this,I),a(t))}get timeWindow(){return o(s(this,L))}set timeWindow(t){h(s(this,L),a(t))}get isRecording(){return o(s(this,H))}set isRecording(t){h(s(this,H),a(t))}get isPlaying(){return o(s(this,T))}set isPlaying(t){h(s(this,T),a(t))}get isForwarding(){return o(s(this,b))}set isForwarding(t){h(s(this,b),a(t))}get history(){return o(s(this,G))}set history(t){h(s(this,G),a(t))}get hasRecording(){return o(s(this,Y))}get startTimestamp(){return o(s(this,_))}get endTimestamp(){return o(s(this,K))}get duration(){return o(s(this,q))}get timestamp(){return o(s(this,U))}set timestamp(t){h(s(this,U),a(t))}get entry(){return o(s(this,z))}loop(){this.isPlaying&&this.entry!=null&&(this.telemetry=this.entry.lines,this.canvas=this.entry.canvas,this.graphs=this.entry.graphs)}get jvmFields(){return o(s(this,V))}set jvmFields(t){h(s(this,V),a(t))}get initialJvmFields(){return o(s(this,W))}set initialJvmFields(t){h(s(this,W),a(t))}get openedStates(){return o(s(this,C))}set openedStates(t){h(s(this,C),a(t))}get searchParam(){return o(s(this,x))}set searchParam(t){h(s(this,x),a(t))}get configurablesState(){return o(s(this,D))}set configurablesState(t){h(s(this,D),a(t))}get batteryVoltage(){return o(s(this,J))}set batteryVoltage(t){h(s(this,J),a(t))}}w=new WeakMap,O=new WeakMap,N=new WeakMap,R=new WeakMap,A=new WeakMap,k=new WeakMap,P=new WeakMap,E=new WeakMap,F=new WeakMap,I=new WeakMap,L=new WeakMap,H=new WeakMap,T=new WeakMap,b=new WeakMap,G=new WeakMap,Y=new WeakMap,_=new WeakMap,K=new WeakMap,q=new WeakMap,U=new WeakMap,z=new WeakMap,V=new WeakMap,W=new WeakMap,C=new WeakMap,x=new WeakMap,D=new WeakMap,J=new WeakMap;var mt=(e=>(e.NORMAL="NORMAL",e.SEARCH="SEARCH",e.DIFF="DIFF",e))(mt||{}),j;class ut{constructor(){r(this,j,l(a([])))}get data(){return o(s(this,j))}set data(t){h(s(this,j),a(t))}add(t){this.data.push({timestamp:Date.now(),text:t})}}j=new WeakMap;var m=(e=>(e.INT="INT",e.DOUBLE="DOUBLE",e.STRING="STRING",e.BOOLEAN="BOOLEAN",e.FLOAT="FLOAT",e.LONG="LONG",e.ENUM="ENUM",e.ARRAY="ARRAY",e.LIST="LIST",e.UNKNOWN="UNKNOWN",e.CUSTOM="CUSTOM",e.MAP="MAP",e.GENERIC="GENERIC",e.GENERIC_NO_ANNOTATION="GENERIC_NO_ANNOTATION",e))(m||{});function X(e,t,i){for(const n of e)(n.type==m.CUSTOM||n.type==m.ARRAY||n.type==m.MAP||n.type==m.LIST)&&Array.isArray(n.customValues)?(i(n),X(n.customValues,t,i)):t(n)}function pt(e,t,i){return e.map(n=>{if((n.type===m.CUSTOM||n.type===m.ARRAY||n.type===m.MAP||n.type===m.LIST)&&Array.isArray(n.customValues)){const g=pt(n.customValues,t,i);return i(n,g)}else return t(n)})}const c=new gt;c.addMessageHandler("time",e=>{d.time=e.time});c.addMessageHandler("opmodes",e=>{d.opModes=e.opModes});c.addMessageHandler("activeOpMode",e=>{d.activeOpMode=e.opMode.name,d.activeOpModeStatus=e.status});const d=new ct;var Q=[],B={},$={rectangles:[],circles:[],lines:[]};c.addMessageHandler("telemetryLinesPacket",e=>{Q=e.lines,d.isPlaying||(d.telemetry=e.lines),d.isRecording&&d.history.push({canvas:$,lines:Q,graphs:B,timestamp:e.timestamp})});c.addMessageHandler("telemetryGraphPacket",e=>{const n=new Date(e.timestamp).getTime()-d.timeWindow*1e3,g={};for(const[p,at]of Object.entries(e.graphs)){const Z=at.filter(v=>new Date(v.timestamp).getTime()>=n),tt=Z.length;if(tt<=1200){g[p]=Z;continue}const nt=(tt-1)/1199,et=[];for(let v=0;v<1200;v++){const st=Math.round(v*nt);et.push(Z[st])}g[p]=et}B=g,d.isPlaying||(d.graphs=g),d.isRecording&&d.history.push({canvas:$,lines:Q,graphs:B,timestamp:e.timestamp})});c.addMessageHandler("telemetryCanvasPacket",e=>{$=e.canvas,d.isPlaying||(d.canvas=e.canvas),d.isRecording&&d.history.push({canvas:$,lines:Q,graphs:B,timestamp:e.timestamp})});c.addMessageHandler("jvmFields",e=>{d.jvmFields=e.fields;const t=i=>{i.isShown=!0};X(d.jvmFields,t,t)});c.addMessageHandler("initialJvmFields",e=>{const t=e.fields,i=new Map;function n(g){i.set(g.id,g.valueString)}X(t,n,n),d.initialJvmFields=i});c.addMessageHandler("updatedJvmFields",e=>{X(d.jvmFields,t=>{for(const i of e.fields)t.id==i.id&&(t.valueString=i.newValueString,t.valueString=i.newValueString,t.value=i.newValueString,t.isValid=!0)},t=>{})});c.addMessageHandler("batteryVoltage",e=>{d.batteryVoltage=e.value});c.addMessageHandler("plugins",e=>{d.plugins=e.plugins});c.addMessageHandler("pluginsUpdate",e=>{const t=e.plugins;for(const i of t){const n=d.plugins.findIndex(g=>g.id===i.id);n!==-1?d.plugins[n]=i:d.plugins.push(i)}});const yt=new ht,St=new ut;export{mt as C,m as T,X as a,pt as f,yt as g,d as i,St as n,c as s};
