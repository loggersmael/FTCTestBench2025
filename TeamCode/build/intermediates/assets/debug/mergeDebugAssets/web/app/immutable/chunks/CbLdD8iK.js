var at=Object.defineProperty;var et=e=>{throw TypeError(e)};var nt=(e,t,i)=>t in e?at(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var m=(e,t,i)=>nt(e,typeof t!="symbol"?t+"":t,i),rt=(e,t,i)=>t.has(e)||et("Cannot "+i);var s=(e,t,i)=>(rt(e,t,"read from private field"),i?i.call(e):t.get(e)),r=(e,t,i)=>t.has(e)?et("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i);import{aK as l,z as o,a3 as h,A as f}from"./7Wps0LQi.js";import{p as a}from"./CZks-J6W.js";var w,S;class ot{constructor(){r(this,w,l(a([])));r(this,S,l(null));m(this,"lastTimestamp",0)}get gamepads(){return o(s(this,w))}set gamepads(t){h(s(this,w),a(t))}get current(){return o(s(this,S))}set current(t){h(s(this,S),a(t))}updateGamepads(){this.gamepads=navigator.getGamepads?Array.from(navigator.getGamepads()).filter(t=>t):[],this.gamepads.length?(this.current=this.gamepads[0],this.lastTimestamp<this.current.timestamp&&(console.log("Update: ",this.current),this.lastTimestamp=this.current.timestamp)):this.current=null}getPS4ButtonLabel(t){return{0:"✕",1:"◯",2:"◻",3:"△",4:"L1",5:"R1",6:"L2",7:"R2",8:"Share",9:"Options",10:"L3",11:"R3",12:"D-Pad Up",13:"D-Pad Down",14:"D-Pad Left",15:"D-Pad Right",16:"PS",17:"Touchpad"}[t]||`B${t}`}}w=new WeakMap,S=new WeakMap;const lt={lines:[],rectangles:[],circles:[]};var v;class ht{constructor(){m(this,"socket",null);m(this,"url",`ws://${window.location.hostname}:8002`);m(this,"messageHandlers",{});m(this,"reconnectInterval",1e3);m(this,"messageQueue",[]);r(this,v,l("closed"));this.messageQueue=[],this.messageHandlers={}}get state(){return o(s(this,v))}set state(t){h(s(this,v),a(t))}init(){return console.log("ran init"),new Promise((t,i)=>{this.socket||(this.socket=new WebSocket(this.url),this.socket.onopen=()=>{this.state="opened",console.log("Connected to WebSocket."),t(),this.flushQueue()},this.socket.onmessage=n=>{const g=JSON.parse(n.data),p=g.kind;p!="time"&&console.log(g),this.handleMessage(p,g)},this.socket.onerror=n=>{console.error("WebSocket error:",n),i(n)},this.socket.onclose=()=>{this.state="closed",console.log("WebSocket closed. Attempting to reconnect..."),setTimeout(async()=>await this.reconnect(),this.reconnectInterval)})})}async reconnect(){this.state=="closed"&&(console.log("Reconnecting..."),this.socket=null,await this.init())}sendMessage(t){this.socket&&this.socket.readyState===WebSocket.OPEN?this.socket.send(JSON.stringify(t)):(console.warn("WebSocket not open. Queuing message."),this.messageQueue.push(JSON.stringify(t)))}flushQueue(){var t;for(;this.messageQueue.length>0&&((t=this.socket)==null?void 0:t.readyState)===WebSocket.OPEN;)this.socket.send(this.messageQueue.shift())}handleMessage(t,i){const n=this.messageHandlers[t];n?n(i):console.warn(`No handler for message kind: ${t}`)}addMessageHandler(t,i){this.messageHandlers[t]=i}removeMessageHandler(t){delete this.messageHandlers[t]}}v=new WeakMap;var y,O,N,A,R,k,E,F,I,P,T,H,L,b,G,B,$,Y,_,U,K,V,W,x,D,C,J,j;class dt{constructor(){r(this,y,l(a([])));r(this,O,l(!1));r(this,N,l(!1));r(this,A,l(""));r(this,R,l(a([])));r(this,k,l("$Stop$Robot$"));r(this,E,l("stopped"));r(this,F,l(a([])));r(this,I,l(a(lt)));r(this,P,l(a({})));r(this,T,l(2));r(this,H,l(!1));r(this,L,l(!1));r(this,b,l(!1));r(this,G,l(a([])));r(this,B,f(()=>this.history.length>0));r(this,$,f(()=>{var t;return((t=this.history.at(0))==null?void 0:t.timestamp)||0}));r(this,Y,f(()=>{var t;return((t=this.history.at(this.history.length-1))==null?void 0:t.timestamp)||0}));r(this,_,f(()=>this.endTimestamp-this.startTimestamp));r(this,U,l(0));r(this,K,f(()=>{var t=0,i=0;for(const n of this.history){if(n.timestamp<=this.timestamp+this.startTimestamp)t=i;else return this.history.at(t);i++}return this.history.at(this.history.length-1)||null}));r(this,V,l(a([])));r(this,W,l(a(new Map)));r(this,x,l(a({})));r(this,D,l(""));r(this,C,l("NORMAL"));r(this,J,l(-1));r(this,j,l(a([])))}get plugins(){return o(s(this,y))}set plugins(t){h(s(this,y),a(t))}get showSettings(){return o(s(this,O))}set showSettings(t){h(s(this,O),a(t))}get showEdit(){return o(s(this,N))}set showEdit(t){h(s(this,N),a(t))}get time(){return o(s(this,A))}set time(t){h(s(this,A),a(t))}get opModes(){return o(s(this,R))}set opModes(t){h(s(this,R),a(t))}get activeOpMode(){return o(s(this,k))}set activeOpMode(t){h(s(this,k),a(t))}get activeOpModeStatus(){return o(s(this,E))}set activeOpModeStatus(t){h(s(this,E),a(t))}get telemetry(){return o(s(this,F))}set telemetry(t){h(s(this,F),a(t))}get canvas(){return o(s(this,I))}set canvas(t){h(s(this,I),a(t))}get graphs(){return o(s(this,P))}set graphs(t){h(s(this,P),a(t))}get timeWindow(){return o(s(this,T))}set timeWindow(t){h(s(this,T),a(t))}get isRecording(){return o(s(this,H))}set isRecording(t){h(s(this,H),a(t))}get isPlaying(){return o(s(this,L))}set isPlaying(t){h(s(this,L),a(t))}get isForwarding(){return o(s(this,b))}set isForwarding(t){h(s(this,b),a(t))}get history(){return o(s(this,G))}set history(t){h(s(this,G),a(t))}get hasRecording(){return o(s(this,B))}get startTimestamp(){return o(s(this,$))}get endTimestamp(){return o(s(this,Y))}get duration(){return o(s(this,_))}get timestamp(){return o(s(this,U))}set timestamp(t){h(s(this,U),a(t))}get entry(){return o(s(this,K))}loop(){this.isPlaying&&this.entry!=null&&(this.telemetry=this.entry.lines,this.canvas=this.entry.canvas,this.graphs=this.entry.graphs)}get jvmFields(){return o(s(this,V))}set jvmFields(t){h(s(this,V),a(t))}get initialJvmFields(){return o(s(this,W))}set initialJvmFields(t){h(s(this,W),a(t))}get openedStates(){return o(s(this,x))}set openedStates(t){h(s(this,x),a(t))}get searchParam(){return o(s(this,D))}set searchParam(t){h(s(this,D),a(t))}get configurablesState(){return o(s(this,C))}set configurablesState(t){h(s(this,C),a(t))}get batteryVoltage(){return o(s(this,J))}set batteryVoltage(t){h(s(this,J),a(t))}get flows(){return o(s(this,j))}set flows(t){h(s(this,j),a(t))}}y=new WeakMap,O=new WeakMap,N=new WeakMap,A=new WeakMap,R=new WeakMap,k=new WeakMap,E=new WeakMap,F=new WeakMap,I=new WeakMap,P=new WeakMap,T=new WeakMap,H=new WeakMap,L=new WeakMap,b=new WeakMap,G=new WeakMap,B=new WeakMap,$=new WeakMap,Y=new WeakMap,_=new WeakMap,U=new WeakMap,K=new WeakMap,V=new WeakMap,W=new WeakMap,x=new WeakMap,D=new WeakMap,C=new WeakMap,J=new WeakMap,j=new WeakMap;var gt=(e=>(e.NORMAL="NORMAL",e.SEARCH="SEARCH",e.DIFF="DIFF",e))(gt||{}),Q;class ct{constructor(){r(this,Q,l(a([])))}get data(){return o(s(this,Q))}set data(t){h(s(this,Q),a(t))}add(t){this.data.push({timestamp:Date.now(),text:t})}}Q=new WeakMap;var u=(e=>(e.INT="INT",e.DOUBLE="DOUBLE",e.STRING="STRING",e.BOOLEAN="BOOLEAN",e.FLOAT="FLOAT",e.LONG="LONG",e.ENUM="ENUM",e.ARRAY="ARRAY",e.LIST="LIST",e.UNKNOWN="UNKNOWN",e.CUSTOM="CUSTOM",e.MAP="MAP",e.GENERIC="GENERIC",e.GENERIC_NO_ANNOTATION="GENERIC_NO_ANNOTATION",e))(u||{});function z(e,t,i){for(const n of e)(n.type==u.CUSTOM||n.type==u.ARRAY||n.type==u.MAP||n.type==u.LIST)&&Array.isArray(n.customValues)?(i(n),z(n.customValues,t,i)):t(n)}function ut(e,t,i){return e.map(n=>{if((n.type===u.CUSTOM||n.type===u.ARRAY||n.type===u.MAP||n.type===u.LIST)&&Array.isArray(n.customValues)){const g=ut(n.customValues,t,i);return i(n,g)}else return t(n)})}const c=new ht;c.addMessageHandler("time",e=>{d.time=e.time});c.addMessageHandler("opmodes",e=>{d.opModes=e.opModes});c.addMessageHandler("activeOpMode",e=>{d.activeOpMode=e.opMode.name,d.activeOpModeStatus=e.status});const d=new dt;c.addMessageHandler("telemetryPacket",e=>{const n=new Date(e.timestamp).getTime()-d.timeWindow*1e3,g={};for(const[p,st]of Object.entries(e.graphs)){const q=st.filter(M=>new Date(M.timestamp).getTime()>=n),X=q.length;if(X<=1200){g[p]=q;continue}const it=(X-1)/1199,Z=[];for(let M=0;M<1200;M++){const tt=Math.round(M*it);Z.push(q[tt])}g[p]=Z}d.isPlaying||(d.telemetry=e.lines,d.canvas=e.canvas,d.graphs=g),d.isRecording&&d.history.push({canvas:e.canvas,lines:e.lines,graphs:g,timestamp:e.timestamp})});c.addMessageHandler("jvmFields",e=>{d.jvmFields=e.fields;const t=i=>{i.isShown=!0};z(d.jvmFields,t,t)});c.addMessageHandler("initialJvmFields",e=>{const t=e.fields,i=new Map;function n(g){i.set(g.id,g.valueString)}z(t,n,n),d.initialJvmFields=i});c.addMessageHandler("updatedJvmFields",e=>{z(d.jvmFields,t=>{for(const i of e.fields)t.id==i.id&&(t.valueString=i.newValueString,t.valueString=i.newValueString,t.value=i.newValueString,t.isValid=!0)},t=>{})});c.addMessageHandler("batteryVoltage",e=>{d.batteryVoltage=e.value});c.addMessageHandler("allFlows",e=>{d.flows=e.flows});c.addMessageHandler("plugins",e=>{d.plugins=e.plugins});c.addMessageHandler("pluginsUpdate",e=>{const t=e.plugins;for(const i of t){const n=d.plugins.findIndex(g=>g.id===i.id);n!==-1?d.plugins[n]=i:d.plugins.push(i)}});const ft=new ot,wt=new ct;export{gt as C,u as T,z as a,ut as f,ft as g,d as i,wt as n,c as s};
