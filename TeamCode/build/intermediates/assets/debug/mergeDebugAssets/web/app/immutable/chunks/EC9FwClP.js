var at=Object.defineProperty;var et=e=>{throw TypeError(e)};var nt=(e,t,a)=>t in e?at(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var u=(e,t,a)=>nt(e,typeof t!="symbol"?t+"":t,a),rt=(e,t,a)=>t.has(e)||et("Cannot "+a);var s=(e,t,a)=>(rt(e,t,"read from private field"),a?a.call(e):t.get(e)),n=(e,t,a)=>t.has(e)?et("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,a);import{aK as h,z as o,a3 as l,A as f}from"./7Wps0LQi.js";import{p as i}from"./CZks-J6W.js";var w,S;class ot{constructor(){n(this,w,h(i([])));n(this,S,h(null));u(this,"lastTimestamp",0)}get gamepads(){return o(s(this,w))}set gamepads(t){l(s(this,w),i(t))}get current(){return o(s(this,S))}set current(t){l(s(this,S),i(t))}updateGamepads(){this.gamepads=navigator.getGamepads?Array.from(navigator.getGamepads()).filter(t=>t):[],this.gamepads.length?(this.current=this.gamepads[0],this.lastTimestamp<this.current.timestamp&&(console.log("Update: ",this.current),this.lastTimestamp=this.current.timestamp)):this.current=null}getPS4ButtonLabel(t){return{0:"✕",1:"◯",2:"◻",3:"△",4:"L1",5:"R1",6:"L2",7:"R2",8:"Share",9:"Options",10:"L3",11:"R3",12:"D-Pad Up",13:"D-Pad Down",14:"D-Pad Left",15:"D-Pad Right",16:"PS",17:"Touchpad"}[t]||`B${t}`}}w=new WeakMap,S=new WeakMap;const ht={lines:[],rectangles:[],circles:[]};var v;class lt{constructor(){u(this,"socket",null);u(this,"url",`ws://${window.location.hostname}:8002`);u(this,"messageHandlers",{});u(this,"reconnectInterval",1e3);u(this,"messageQueue",[]);n(this,v,h("closed"));this.messageQueue=[],this.messageHandlers={}}get state(){return o(s(this,v))}set state(t){l(s(this,v),i(t))}init(){return console.log("ran init"),new Promise((t,a)=>{this.socket||(this.socket=new WebSocket(this.url),this.socket.onopen=()=>{this.state="opened",console.log("Connected to WebSocket."),t(),this.flushQueue()},this.socket.onmessage=r=>{const g=JSON.parse(r.data),p=g.kind;p!="time"&&console.log(g),this.handleMessage(p,g)},this.socket.onerror=r=>{console.error("WebSocket error:",r),a(r)},this.socket.onclose=()=>{this.state="closed",console.log("WebSocket closed. Attempting to reconnect..."),setTimeout(async()=>await this.reconnect(),this.reconnectInterval)})})}async reconnect(){this.state=="closed"&&(console.log("Reconnecting..."),this.socket=null,await this.init())}sendMessage(t){this.socket&&this.socket.readyState===WebSocket.OPEN?this.socket.send(JSON.stringify(t)):(console.warn("WebSocket not open. Queuing message."),this.messageQueue.push(JSON.stringify(t)))}flushQueue(){var t;for(;this.messageQueue.length>0&&((t=this.socket)==null?void 0:t.readyState)===WebSocket.OPEN;)this.socket.send(this.messageQueue.shift())}handleMessage(t,a){const r=this.messageHandlers[t];r?r(a):console.warn(`No handler for message kind: ${t}`)}addMessageHandler(t,a){this.messageHandlers[t]=a}removeMessageHandler(t){delete this.messageHandlers[t]}}v=new WeakMap;var y,O,N,A,R,k,E,F,I,P,T,H,L,b,G,B,$,Y,_,U,K,V,W,D,C,J,j,x;class dt{constructor(){n(this,y,h(i([])));n(this,O,h(!1));n(this,N,h(!1));n(this,A,h(""));n(this,R,h(i([])));n(this,k,h("$Stop$Robot$"));n(this,E,h("stopped"));n(this,F,h(i([])));n(this,I,h(i(ht)));n(this,P,h(i({})));n(this,T,h(2));n(this,H,h(!1));n(this,L,h(!1));n(this,b,h(!1));n(this,G,h(i([])));n(this,B,f(()=>this.history.length>0));n(this,$,f(()=>{var t;return((t=this.history.at(0))==null?void 0:t.timestamp)||0}));n(this,Y,f(()=>{var t;return((t=this.history.at(this.history.length-1))==null?void 0:t.timestamp)||0}));n(this,_,f(()=>this.endTimestamp-this.startTimestamp));n(this,U,h(0));n(this,K,f(()=>{var t=0,a=0;for(const r of this.history){if(r.timestamp<=this.timestamp+this.startTimestamp)t=a;else return this.history.at(t);a++}return this.history.at(this.history.length-1)||null}));n(this,V,h(i([])));n(this,W,h(i(new Map)));n(this,D,h(i({})));n(this,C,h(""));n(this,J,h("NORMAL"));n(this,j,h(-1));n(this,x,h(i([])))}get plugins(){return o(s(this,y))}set plugins(t){l(s(this,y),i(t))}get showSettings(){return o(s(this,O))}set showSettings(t){l(s(this,O),i(t))}get showEdit(){return o(s(this,N))}set showEdit(t){l(s(this,N),i(t))}get time(){return o(s(this,A))}set time(t){l(s(this,A),i(t))}get opModes(){return o(s(this,R))}set opModes(t){l(s(this,R),i(t))}get activeOpMode(){return o(s(this,k))}set activeOpMode(t){l(s(this,k),i(t))}get activeOpModeStatus(){return o(s(this,E))}set activeOpModeStatus(t){l(s(this,E),i(t))}get telemetry(){return o(s(this,F))}set telemetry(t){l(s(this,F),i(t))}get canvas(){return o(s(this,I))}set canvas(t){l(s(this,I),i(t))}get graphs(){return o(s(this,P))}set graphs(t){l(s(this,P),i(t))}get timeWindow(){return o(s(this,T))}set timeWindow(t){l(s(this,T),i(t))}get isRecording(){return o(s(this,H))}set isRecording(t){l(s(this,H),i(t))}get isPlaying(){return o(s(this,L))}set isPlaying(t){l(s(this,L),i(t))}get isForwarding(){return o(s(this,b))}set isForwarding(t){l(s(this,b),i(t))}get history(){return o(s(this,G))}set history(t){l(s(this,G),i(t))}get hasRecording(){return o(s(this,B))}get startTimestamp(){return o(s(this,$))}get endTimestamp(){return o(s(this,Y))}get duration(){return o(s(this,_))}get timestamp(){return o(s(this,U))}set timestamp(t){l(s(this,U),i(t))}get entry(){return o(s(this,K))}loop(){this.isPlaying&&this.entry!=null&&(this.telemetry=this.entry.lines,this.canvas=this.entry.canvas,this.graphs=this.entry.graphs)}get jvmFields(){return o(s(this,V))}set jvmFields(t){l(s(this,V),i(t))}get initialJvmFields(){return o(s(this,W))}set initialJvmFields(t){l(s(this,W),i(t))}get openedStates(){return o(s(this,D))}set openedStates(t){l(s(this,D),i(t))}get searchParam(){return o(s(this,C))}set searchParam(t){l(s(this,C),i(t))}get configurablesState(){return o(s(this,J))}set configurablesState(t){l(s(this,J),i(t))}get batteryVoltage(){return o(s(this,j))}set batteryVoltage(t){l(s(this,j),i(t))}get flows(){return o(s(this,x))}set flows(t){l(s(this,x),i(t))}}y=new WeakMap,O=new WeakMap,N=new WeakMap,A=new WeakMap,R=new WeakMap,k=new WeakMap,E=new WeakMap,F=new WeakMap,I=new WeakMap,P=new WeakMap,T=new WeakMap,H=new WeakMap,L=new WeakMap,b=new WeakMap,G=new WeakMap,B=new WeakMap,$=new WeakMap,Y=new WeakMap,_=new WeakMap,U=new WeakMap,K=new WeakMap,V=new WeakMap,W=new WeakMap,D=new WeakMap,C=new WeakMap,J=new WeakMap,j=new WeakMap,x=new WeakMap;var gt=(e=>(e.NORMAL="NORMAL",e.SEARCH="SEARCH",e.DIFF="DIFF",e))(gt||{}),Q;class ct{constructor(){n(this,Q,h(i([])))}get data(){return o(s(this,Q))}set data(t){l(s(this,Q),i(t))}add(t){this.data.push({timestamp:Date.now(),text:t})}}Q=new WeakMap;var m=(e=>(e.INT="INT",e.DOUBLE="DOUBLE",e.STRING="STRING",e.BOOLEAN="BOOLEAN",e.FLOAT="FLOAT",e.LONG="LONG",e.ENUM="ENUM",e.ARRAY="ARRAY",e.LIST="LIST",e.UNKNOWN="UNKNOWN",e.CUSTOM="CUSTOM",e.MAP="MAP",e.GENERIC="GENERIC",e.GENERIC_NO_ANNOTATION="GENERIC_NO_ANNOTATION",e))(m||{});function z(e,t,a){for(const r of e)(r.type==m.CUSTOM||r.type==m.ARRAY||r.type==m.MAP||r.type==m.LIST)&&Array.isArray(r.customValues)?(a(r),z(r.customValues,t,a)):t(r)}function mt(e,t,a){return e.map(r=>{if((r.type===m.CUSTOM||r.type===m.ARRAY||r.type===m.MAP||r.type===m.LIST)&&Array.isArray(r.customValues)){const g=mt(r.customValues,t,a);return a(r,g)}else return t(r)})}const c=new lt;c.addMessageHandler("time",e=>{d.time=e.time});c.addMessageHandler("opmodes",e=>{d.opModes=e.opModes});c.addMessageHandler("activeOpMode",e=>{d.activeOpMode=e.opMode.name,d.activeOpModeStatus=e.status});const d=new dt;c.addMessageHandler("telemetryPacket",e=>{const r=new Date(e.timestamp).getTime()-d.timeWindow*1e3,g={};for(const[p,st]of Object.entries(e.graphs)){const q=st.filter(M=>new Date(M.timestamp).getTime()>=r),X=q.length;if(X<=1200){g[p]=q;continue}const it=(X-1)/1199,Z=[];for(let M=0;M<1200;M++){const tt=Math.round(M*it);Z.push(q[tt])}g[p]=Z}d.isPlaying||(d.telemetry=e.lines,d.canvas=e.canvas,d.graphs=g),d.isRecording&&d.history.push({canvas:e.canvas,lines:e.lines,graphs:g,timestamp:e.timestamp})});c.addMessageHandler("jvmFields",e=>{d.jvmFields=e.fields;const t=a=>{a.isShown=!0};z(d.jvmFields,t,t)});c.addMessageHandler("initialJvmFields",e=>{const t=e.fields,a=new Map;function r(g){a.set(g.id,g.valueString)}z(t,r,r),d.initialJvmFields=a});c.addMessageHandler("updatedJvmFields",e=>{z(d.jvmFields,t=>{for(const a of e.fields)t.id==a.id&&(t.valueString=a.newValueString,t.valueString=a.newValueString,t.value=a.newValueString,t.isValid=!0)},t=>{})});c.addMessageHandler("batteryVoltage",e=>{d.batteryVoltage=e.value});c.addMessageHandler("allFlows",e=>{d.flows=e.flows});c.addMessageHandler("plugins",e=>{d.plugins=e.plugins});c.addMessageHandler("pluginsUpdate",e=>{e.plugins});const ft=new ot,wt=new ct;export{gt as C,m as T,z as a,mt as f,ft as g,d as i,wt as n,c as s};
