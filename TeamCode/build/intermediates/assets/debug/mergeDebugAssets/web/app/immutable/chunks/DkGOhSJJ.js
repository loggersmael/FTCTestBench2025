var nt=Object.defineProperty;var st=e=>{throw TypeError(e)};var rt=(e,t,i)=>t in e?nt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var u=(e,t,i)=>rt(e,typeof t!="symbol"?t+"":t,i),ot=(e,t,i)=>t.has(e)||st("Cannot "+i);var s=(e,t,i)=>(ot(e,t,"read from private field"),i?i.call(e):t.get(e)),r=(e,t,i)=>t.has(e)?st("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i);import{a9 as h,o,G as d,q as v}from"./DImaOtgy.js";import{p as a}from"./CyCUbHaQ.js";var M,S;class lt{constructor(){r(this,M,h(a([])));r(this,S,h(null));u(this,"lastTimestamp",0)}get gamepads(){return o(s(this,M))}set gamepads(t){d(s(this,M),a(t))}get current(){return o(s(this,S))}set current(t){d(s(this,S),a(t))}updateGamepads(){this.gamepads=navigator.getGamepads?Array.from(navigator.getGamepads()).filter(t=>t):[],this.gamepads.length?(this.current=this.gamepads[0],this.lastTimestamp<this.current.timestamp&&(console.log("Update: ",this.current),this.lastTimestamp=this.current.timestamp)):this.current=null}getPS4ButtonLabel(t){return{0:"✕",1:"◯",2:"◻",3:"△",4:"L1",5:"R1",6:"L2",7:"R2",8:"Share",9:"Options",10:"L3",11:"R3",12:"D-Pad Up",13:"D-Pad Down",14:"D-Pad Left",15:"D-Pad Right",16:"PS",17:"Touchpad"}[t]||`B${t}`}}M=new WeakMap,S=new WeakMap;const ht={offsetX:0,offsetY:0,rotation:"DEG_0",lines:[],rectangles:[],circles:[]};var y;class dt{constructor(){u(this,"socket",null);u(this,"url",`ws://${window.location.hostname}:8002`);u(this,"messageHandlers",{});u(this,"reconnectInterval",1e3);u(this,"messageQueue",[]);r(this,y,h("closed"));this.messageQueue=[],this.messageHandlers={}}get state(){return o(s(this,y))}set state(t){d(s(this,y),a(t))}init(){return console.log("ran init"),new Promise((t,i)=>{this.socket||(this.socket=new WebSocket(this.url),this.socket.onopen=()=>{this.state="opened",console.log("Connected to WebSocket."),t(),this.flushQueue()},this.socket.onmessage=n=>{const c=JSON.parse(n.data),p=c.kind;p!="time"&&console.log(c),this.handleMessage(p,c)},this.socket.onerror=n=>{console.error("WebSocket error:",n),i(n)},this.socket.onclose=()=>{this.state="closed",console.log("WebSocket closed. Attempting to reconnect..."),setTimeout(async()=>await this.reconnect(),this.reconnectInterval)})})}async reconnect(){this.state=="closed"&&(console.log("Reconnecting..."),this.socket=null,await this.init())}sendMessage(t){this.socket&&this.socket.readyState===WebSocket.OPEN?this.socket.send(JSON.stringify(t)):(console.warn("WebSocket not open. Queuing message."),this.messageQueue.push(JSON.stringify(t)))}flushQueue(){var t;for(;this.messageQueue.length>0&&((t=this.socket)==null?void 0:t.readyState)===WebSocket.OPEN;)this.socket.send(this.messageQueue.shift())}handleMessage(t,i){const n=this.messageHandlers[t];n?n(i):console.warn(`No handler for message kind: ${t}`)}addMessageHandler(t,i){this.messageHandlers[t]=i}removeMessageHandler(t){delete this.messageHandlers[t]}}y=new WeakMap;var O,R,N,w,A,E,k,P,I,F,H,L,T,b,B,Y,$,K,G,X,C,U,D,V,W,x;class ct{constructor(){r(this,O,h(a([])));r(this,R,h(!1));r(this,N,h(""));r(this,w,h(a([])));r(this,A,h("$Stop$Robot$"));r(this,E,h("stopped"));r(this,k,h(a([])));r(this,P,h(a(ht)));r(this,I,h(a({})));r(this,F,h(2));r(this,H,h(!1));r(this,L,h(!1));r(this,T,h(!1));r(this,b,h(a([])));r(this,B,v(()=>this.history.length>0));r(this,Y,v(()=>{var t;return((t=this.history.at(0))==null?void 0:t.timestamp)||0}));r(this,$,v(()=>{var t;return((t=this.history.at(this.history.length-1))==null?void 0:t.timestamp)||0}));r(this,K,v(()=>this.endTimestamp-this.startTimestamp));r(this,G,h(0));r(this,X,v(()=>{var t=0,i=0;for(const n of this.history){if(n.timestamp<=this.timestamp+this.startTimestamp)t=i;else return this.history.at(t);i++}return this.history.at(this.history.length-1)||null}));r(this,C,h(a([])));r(this,U,h(a(new Map)));r(this,D,h(a({})));r(this,V,h(""));r(this,W,h("NORMAL"));r(this,x,h(-1))}get plugins(){return o(s(this,O))}set plugins(t){d(s(this,O),a(t))}get showSettings(){return o(s(this,R))}set showSettings(t){d(s(this,R),a(t))}get time(){return o(s(this,N))}set time(t){d(s(this,N),a(t))}get opModes(){return o(s(this,w))}set opModes(t){d(s(this,w),a(t))}get activeOpMode(){return o(s(this,A))}set activeOpMode(t){d(s(this,A),a(t))}get activeOpModeStatus(){return o(s(this,E))}set activeOpModeStatus(t){d(s(this,E),a(t))}get telemetry(){return o(s(this,k))}set telemetry(t){d(s(this,k),a(t))}get canvas(){return o(s(this,P))}set canvas(t){d(s(this,P),a(t))}get graphs(){return o(s(this,I))}set graphs(t){d(s(this,I),a(t))}get timeWindow(){return o(s(this,F))}set timeWindow(t){d(s(this,F),a(t))}get isRecording(){return o(s(this,H))}set isRecording(t){d(s(this,H),a(t))}get isPlaying(){return o(s(this,L))}set isPlaying(t){d(s(this,L),a(t))}get isForwarding(){return o(s(this,T))}set isForwarding(t){d(s(this,T),a(t))}get history(){return o(s(this,b))}set history(t){d(s(this,b),a(t))}get hasRecording(){return o(s(this,B))}get startTimestamp(){return o(s(this,Y))}get endTimestamp(){return o(s(this,$))}get duration(){return o(s(this,K))}get timestamp(){return o(s(this,G))}set timestamp(t){d(s(this,G),a(t))}get entry(){return o(s(this,X))}loop(){this.isPlaying&&this.entry!=null&&(this.telemetry=this.entry.lines,this.canvas=this.entry.canvas,this.graphs=this.entry.graphs)}get jvmFields(){return o(s(this,C))}set jvmFields(t){d(s(this,C),a(t))}get initialJvmFields(){return o(s(this,U))}set initialJvmFields(t){d(s(this,U),a(t))}get openedStates(){return o(s(this,D))}set openedStates(t){d(s(this,D),a(t))}get searchParam(){return o(s(this,V))}set searchParam(t){d(s(this,V),a(t))}get configurablesState(){return o(s(this,W))}set configurablesState(t){d(s(this,W),a(t))}get batteryVoltage(){return o(s(this,x))}set batteryVoltage(t){d(s(this,x),a(t))}}O=new WeakMap,R=new WeakMap,N=new WeakMap,w=new WeakMap,A=new WeakMap,E=new WeakMap,k=new WeakMap,P=new WeakMap,I=new WeakMap,F=new WeakMap,H=new WeakMap,L=new WeakMap,T=new WeakMap,b=new WeakMap,B=new WeakMap,Y=new WeakMap,$=new WeakMap,K=new WeakMap,G=new WeakMap,X=new WeakMap,C=new WeakMap,U=new WeakMap,D=new WeakMap,V=new WeakMap,W=new WeakMap,x=new WeakMap;var gt=(e=>(e.NORMAL="NORMAL",e.SEARCH="SEARCH",e.DIFF="DIFF",e))(gt||{}),J;class mt{constructor(){r(this,J,h(a([])))}get data(){return o(s(this,J))}set data(t){d(s(this,J),a(t))}add(t){this.data.push({timestamp:Date.now(),text:t})}}J=new WeakMap;var m=(e=>(e.INT="INT",e.DOUBLE="DOUBLE",e.STRING="STRING",e.BOOLEAN="BOOLEAN",e.FLOAT="FLOAT",e.LONG="LONG",e.ENUM="ENUM",e.ARRAY="ARRAY",e.LIST="LIST",e.UNKNOWN="UNKNOWN",e.CUSTOM="CUSTOM",e.MAP="MAP",e.GENERIC="GENERIC",e.RECURSION_REACHED="RECURSION_REACHED",e.GENERIC_NO_ANNOTATION="GENERIC_NO_ANNOTATION",e))(m||{});function q(e,t,i){for(const n of e)(n.type==m.CUSTOM||n.type==m.ARRAY||n.type==m.MAP||n.type==m.LIST)&&Array.isArray(n.customValues)?(i(n),q(n.customValues,t,i)):t(n)}function ut(e,t,i){return e.map(n=>{if((n.type===m.CUSTOM||n.type===m.ARRAY||n.type===m.MAP||n.type===m.LIST)&&Array.isArray(n.customValues)){const c=ut(n.customValues,t,i);return i(n,c)}else return t(n)})}const g=new dt;g.addMessageHandler("time",e=>{l.time=e.time});g.addMessageHandler("opmodes",e=>{l.opModes=e.opModes});g.addMessageHandler("activeOpMode",e=>{l.activeOpMode=e.opMode.name,l.activeOpModeStatus=e.status});const l=new ct;var j=[],Q={},_={offsetX:0,offsetY:0,rotation:"DEG_0",rectangles:[],circles:[],lines:[]};g.addMessageHandler("telemetryLinesPacket",e=>{j=e.lines,l.isPlaying||(l.telemetry=e.lines),l.isRecording&&l.history.push({canvas:_,lines:j,graphs:Q,timestamp:e.timestamp})});g.addMessageHandler("telemetryGraphPacket",e=>{const n=new Date(e.timestamp).getTime()-l.timeWindow*1e3,c={};for(const[p,it]of Object.entries(e.graphs)){const z=it.filter(f=>new Date(f.timestamp).getTime()>=n),Z=z.length;if(Z<=1200){c[p]=z;continue}const at=(Z-1)/1199,tt=[];for(let f=0;f<1200;f++){const et=Math.round(f*at);tt.push(z[et])}c[p]=tt}Q=c,l.isPlaying||(l.graphs=c),l.isRecording&&l.history.push({canvas:_,lines:j,graphs:Q,timestamp:e.timestamp})});g.addMessageHandler("telemetryCanvasPacket",e=>{_=e.canvas,l.isPlaying||(l.canvas=e.canvas),l.isRecording&&l.history.push({canvas:_,lines:j,graphs:Q,timestamp:e.timestamp})});g.addMessageHandler("jvmFields",e=>{l.jvmFields=e.fields;const t=i=>{i.isShown=!0};q(l.jvmFields,t,t)});g.addMessageHandler("initialJvmFields",e=>{const t=e.fields,i=new Map;function n(c){i.set(c.id,c.valueString)}q(t,n,n),l.initialJvmFields=i});g.addMessageHandler("updatedJvmFields",e=>{q(l.jvmFields,t=>{for(const i of e.fields)t.id==i.id&&(t.valueString=i.newValueString,t.valueString=i.newValueString,t.value=i.newValueString,t.isValid=!0)},t=>{})});g.addMessageHandler("batteryVoltage",e=>{l.batteryVoltage=e.value});g.addMessageHandler("plugins",e=>{l.plugins=e.plugins});g.addMessageHandler("pluginsUpdate",e=>{const t=e.plugins;for(const i of t){const n=l.plugins.findIndex(c=>c.id===i.id);n!==-1?l.plugins[n]=i:l.plugins.push(i)}});const Mt=new lt,St=new mt;export{gt as C,m as T,q as a,ut as f,Mt as g,l as i,St as n,g as s};
