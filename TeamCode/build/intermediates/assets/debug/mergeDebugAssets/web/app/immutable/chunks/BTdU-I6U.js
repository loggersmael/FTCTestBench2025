var dt=Object.defineProperty;var ot=e=>{throw TypeError(e)};var gt=(e,t,s)=>t in e?dt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var M=(e,t,s)=>gt(e,typeof t!="symbol"?t+"":t,s),ut=(e,t,s)=>t.has(e)||ot("Cannot "+s);var a=(e,t,s)=>(ut(e,t,"read from private field"),s?s.call(e):t.get(e)),n=(e,t,s)=>t.has(e)?ot("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s);import{b as mt,ae as pt,n as ft,aH as vt,G as St,h as st,k as wt,aC as c,d as o,a5 as d,a2 as y,W as J,X as Y,V as lt,T as Mt,aG as yt}from"./DxySB33y.js";import{a as r,p as et,i as Nt}from"./DQEzFBYC.js";import{t as it,b as K,e as Ot}from"./DgPgYHzS.js";import{s as At}from"./DG_-0HLc.js";function at(e,t,...s){var i=e,l=vt,h;mt(()=>{l!==(l=t())&&(h&&(St(h),h=null),h=ft(()=>l(i,...s)))},pt),st&&(i=wt)}const ht=[...` 	
\r\f \v\uFEFF`];function Rt(e,t,s){var i=e==null?"":""+e;if(s){for(var l in s)if(s[l])i=i?i+" "+l:l;else if(i.length)for(var h=l.length,m=0;(m=i.indexOf(l,m))>=0;){var g=m+h;(m===0||ht.includes(i[m-1]))&&(g===i.length||ht.includes(i[g]))?i=(m===0?"":i.substring(0,m))+i.substring(g+1):m=g}}return i===""?null:i}function Bt(e,t){return e==null?null:String(e)}function kt(e,t,s,i,l,h){var m=e.__className;if(st||m!==s){var g=Rt(s,i,h);(!st||g!==e.getAttribute("class"))&&(g==null?e.removeAttribute("class"):t?e.className=g:e.setAttribute("class",g)),e.__className=s}else if(h&&l!==h)for(var v in h){var w=!!h[v];(l==null||w!==!!l[v])&&e.classList.toggle(v,w)}return h}var N,O;class bt{constructor(){n(this,N,c(r([])));n(this,O,c(null));M(this,"lastTimestamp",0)}get gamepads(){return o(a(this,N))}set gamepads(t){d(a(this,N),r(t))}get current(){return o(a(this,O))}set current(t){d(a(this,O),r(t))}updateGamepads(){this.gamepads=navigator.getGamepads?Array.from(navigator.getGamepads()).filter(t=>t):[],this.gamepads.length?(this.current=this.gamepads[0],this.lastTimestamp<this.current.timestamp&&(console.log("Update: ",this.current),this.lastTimestamp=this.current.timestamp)):this.current=null}getPS4ButtonLabel(t){return{0:"✕",1:"◯",2:"◻",3:"△",4:"L1",5:"R1",6:"L2",7:"R2",8:"Share",9:"Options",10:"L3",11:"R3",12:"D-Pad Up",13:"D-Pad Down",14:"D-Pad Left",15:"D-Pad Right",16:"PS",17:"Touchpad"}[t]||`B${t}`}}N=new WeakMap,O=new WeakMap;const Pt={lines:[],rectangles:[],circles:[]};var A;class Tt{constructor(){M(this,"socket",null);M(this,"url",`ws://${window.location.hostname}:8002`);M(this,"messageHandlers",{});M(this,"reconnectInterval",1e3);M(this,"messageQueue",[]);n(this,A,c("closed"));this.messageQueue=[],this.messageHandlers={}}get state(){return o(a(this,A))}set state(t){d(a(this,A),r(t))}init(){return console.log("ran init"),new Promise((t,s)=>{this.socket||(this.socket=new WebSocket(this.url),this.socket.onopen=()=>{this.state="opened",console.log("Connected to WebSocket."),t(),this.flushQueue()},this.socket.onmessage=i=>{const l=JSON.parse(i.data),h=l.kind;h!="time"&&console.log(l),this.handleMessage(h,l)},this.socket.onerror=i=>{console.error("WebSocket error:",i),s(i)},this.socket.onclose=()=>{this.state="closed",console.log("WebSocket closed. Attempting to reconnect..."),setTimeout(async()=>await this.reconnect(),this.reconnectInterval)})})}async reconnect(){this.state=="closed"&&(console.log("Reconnecting..."),this.socket=null,await this.init())}sendMessage(t){this.socket&&this.socket.readyState===WebSocket.OPEN?this.socket.send(JSON.stringify(t)):(console.warn("WebSocket not open. Queuing message."),this.messageQueue.push(JSON.stringify(t)))}flushQueue(){var t;for(;this.messageQueue.length>0&&((t=this.socket)==null?void 0:t.readyState)===WebSocket.OPEN;)this.socket.send(this.messageQueue.shift())}handleMessage(t,s){const i=this.messageHandlers[t];i?i(s):console.warn(`No handler for message kind: ${t}`)}addMessageHandler(t,s){this.messageHandlers[t]=s}removeMessageHandler(t){delete this.messageHandlers[t]}}A=new WeakMap;var R,k,b,P,T,E,H,I,L,F,G,V,W,X,q,z,Z,U,tt,C,j,x,D,Q;class Et{constructor(){n(this,R,c(!1));n(this,k,c(""));n(this,b,c(r([])));n(this,P,c("$Stop$Robot$"));n(this,T,c("stopped"));n(this,E,c(r([])));n(this,H,c(r(Pt)));n(this,I,c(r({})));n(this,L,c(2));n(this,F,c(!1));n(this,G,c(!1));n(this,V,c(!1));n(this,W,c(r([])));n(this,X,y(()=>this.history.length>0));n(this,q,y(()=>{var t;return((t=this.history.at(0))==null?void 0:t.timestamp)||0}));n(this,z,y(()=>{var t;return((t=this.history.at(this.history.length-1))==null?void 0:t.timestamp)||0}));n(this,Z,y(()=>this.endTimestamp-this.startTimestamp));n(this,U,c(0));n(this,tt,y(()=>{var t=0,s=0;for(const i of this.history){if(i.timestamp<=this.timestamp+this.startTimestamp)t=s;else return this.history.at(t);s++}return this.history.at(this.history.length-1)||null}));n(this,C,c(r([])));n(this,j,c(r({})));n(this,x,c(""));n(this,D,c(-1));n(this,Q,c(r([])))}get showSettings(){return o(a(this,R))}set showSettings(t){d(a(this,R),r(t))}get time(){return o(a(this,k))}set time(t){d(a(this,k),r(t))}get opModes(){return o(a(this,b))}set opModes(t){d(a(this,b),r(t))}get activeOpMode(){return o(a(this,P))}set activeOpMode(t){d(a(this,P),r(t))}get activeOpModeStatus(){return o(a(this,T))}set activeOpModeStatus(t){d(a(this,T),r(t))}get telemetry(){return o(a(this,E))}set telemetry(t){d(a(this,E),r(t))}get canvas(){return o(a(this,H))}set canvas(t){d(a(this,H),r(t))}get graphs(){return o(a(this,I))}set graphs(t){d(a(this,I),r(t))}get timeWindow(){return o(a(this,L))}set timeWindow(t){d(a(this,L),r(t))}get isRecording(){return o(a(this,F))}set isRecording(t){d(a(this,F),r(t))}get isPlaying(){return o(a(this,G))}set isPlaying(t){d(a(this,G),r(t))}get isForwarding(){return o(a(this,V))}set isForwarding(t){d(a(this,V),r(t))}get history(){return o(a(this,W))}set history(t){d(a(this,W),r(t))}get hasRecording(){return o(a(this,X))}get startTimestamp(){return o(a(this,q))}get endTimestamp(){return o(a(this,z))}get duration(){return o(a(this,Z))}get timestamp(){return o(a(this,U))}set timestamp(t){d(a(this,U),r(t))}get entry(){return o(a(this,tt))}loop(){this.isPlaying&&this.entry!=null&&(this.telemetry=this.entry.lines,this.canvas=this.entry.canvas,this.graphs=this.entry.graphs)}get jvmFields(){return o(a(this,C))}set jvmFields(t){d(a(this,C),r(t))}get openedStates(){return o(a(this,j))}set openedStates(t){d(a(this,j),r(t))}get searchParam(){return o(a(this,x))}set searchParam(t){d(a(this,x),r(t))}get batteryVoltage(){return o(a(this,D))}set batteryVoltage(t){d(a(this,D),r(t))}get flows(){return o(a(this,Q))}set flows(t){d(a(this,Q),r(t))}}R=new WeakMap,k=new WeakMap,b=new WeakMap,P=new WeakMap,T=new WeakMap,E=new WeakMap,H=new WeakMap,I=new WeakMap,L=new WeakMap,F=new WeakMap,G=new WeakMap,V=new WeakMap,W=new WeakMap,X=new WeakMap,q=new WeakMap,z=new WeakMap,Z=new WeakMap,U=new WeakMap,tt=new WeakMap,C=new WeakMap,j=new WeakMap,x=new WeakMap,D=new WeakMap,Q=new WeakMap;var $;class Ht{constructor(){n(this,$,c(r([])))}get data(){return o(a(this,$))}set data(t){d(a(this,$),r(t))}add(t){this.data.push({timestamp:Date.now(),text:t})}}$=new WeakMap;var f=(e=>(e.INT="INT",e.DOUBLE="DOUBLE",e.STRING="STRING",e.BOOLEAN="BOOLEAN",e.FLOAT="FLOAT",e.LONG="LONG",e.ENUM="ENUM",e.ARRAY="ARRAY",e.LIST="LIST",e.UNKNOWN="UNKNOWN",e.CUSTOM="CUSTOM",e.MAP="MAP",e.GENERIC="GENERIC",e.GENERIC_NO_ANNOTATION="GENERIC_NO_ANNOTATION",e))(f||{});function rt(e,t,s){for(const i of e)(i.type==f.CUSTOM||i.type==f.ARRAY||i.type==f.MAP||i.type==f.LIST)&&Array.isArray(i.customValues)?(s(i),rt(i.customValues,t,s)):t(i)}function It(e,t,s){return e.map(i=>{if((i.type===f.CUSTOM||i.type===f.ARRAY||i.type===f.MAP||i.type===f.LIST)&&Array.isArray(i.customValues)){const l=It(i.customValues,t,s);return s(i,l)}else return t(i)})}const S=new Tt;S.addMessageHandler("time",e=>{u.time=e.time});S.addMessageHandler("opmodes",e=>{u.opModes=e.opModes});S.addMessageHandler("activeOpMode",e=>{u.activeOpMode=e.opMode.name,u.activeOpModeStatus=e.status});const u=new Et;S.addMessageHandler("telemetryPacket",e=>{const i=new Date(e.timestamp).getTime()-u.timeWindow*1e3,l={};for(const[h,m]of Object.entries(e.graphs)){const g=m.filter(p=>new Date(p.timestamp).getTime()>=i),v=g.length;if(v<=1200){l[h]=g;continue}const w=(v-1)/1199,B=[];for(let p=0;p<1200;p++){const _=Math.round(p*w);B.push(g[_])}l[h]=B}u.isPlaying||(u.telemetry=e.lines,u.canvas=e.canvas,u.graphs=l),u.isRecording&&u.history.push({canvas:e.canvas,lines:e.lines,graphs:l,timestamp:e.timestamp})});S.addMessageHandler("jvmFields",e=>{u.jvmFields=e.fields;const t=s=>{s.isShown=!0};rt(u.jvmFields,t,t)});S.addMessageHandler("updatedJvmFields",e=>{rt(u.jvmFields,t=>{for(const s of e.fields)t.id==s.id&&(t.valueString=s.newValueString,t.valueString=s.newValueString,t.value=s.newValueString,t.isValid=!0)},t=>{})});S.addMessageHandler("batteryVoltage",e=>{u.batteryVoltage=e.value});S.addMessageHandler("allFlows",e=>{u.flows=e.flows});const _t=new bt,Jt=new Ht;var Lt=it('<div class="header svelte-pv3xha"><!></div>');function Ft(e,t){var s=Lt(),i=J(s);at(i,()=>t.children),Y(s),K(e,s)}var Gt=it('<h2 class="svelte-opkjd0"><!></h2>');function Vt(e,t){var s=Gt(),i=J(s);at(i,()=>t.children),Y(s),K(e,s)}var Wt=it('<section><!> <div class="main svelte-kkws1o"><!></div></section>');function Yt(e,t){let s=et(t,"title",3,""),i=et(t,"hasMargin",3,!0),l=et(t,"maxHeight",3,!1);var h=Wt();let m;var g=J(h);{var v=p=>{Ft(p,{children:(_,Ut)=>{Vt(_,{children:(ct,Ct)=>{yt();var nt=Ot();lt(()=>At(nt,s())),K(ct,nt)}})}})};Nt(g,p=>{s()!=""&&p(v)})}var w=Mt(g,2),B=J(w);at(B,()=>t.children),Y(w),Y(h),lt(p=>m=kt(h,1,"svelte-kkws1o",null,m,p),[()=>({hasMargin:i(),maxHeight:l()})]),K(e,h)}export{Ft as H,Yt as S,Vt as T,at as a,S as b,f as c,It as d,rt as f,_t as g,u as i,Jt as n,kt as s,Bt as t};
