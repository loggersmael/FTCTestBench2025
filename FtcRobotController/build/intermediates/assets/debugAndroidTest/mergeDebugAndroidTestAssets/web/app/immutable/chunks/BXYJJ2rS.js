var ft=Object.defineProperty;var dt=e=>{throw TypeError(e)};var vt=(e,t,i)=>t in e?ft(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var S=(e,t,i)=>vt(e,typeof t!="symbol"?t+"":t,i),Mt=(e,t,i)=>t.has(e)||dt("Cannot "+i);var s=(e,t,i)=>(Mt(e,t,"read from private field"),i?i.call(e):t.get(e)),r=(e,t,i)=>t.has(e)?dt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i);import{B as St,af as wt,O as yt,a5 as mt,a2 as Nt,h as nt,J as Ot,aE as h,o,a8 as c,w as y,d as rt,i as ot,t as gt,s as At,aH as Rt}from"./DLBbvs7e.js";import{a as n,p as z,i as bt}from"./Bs98DhGR.js";import{t as lt,b as X,e as Et}from"./AckLZTS8.js";import{s as Pt}from"./CkUz7bwT.js";function ht(e,t,...i){var a=e,l=mt,d;St(()=>{l!==(l=t())&&(d&&(Nt(d),d=null),d=yt(()=>l(a,...i)))},wt),nt&&(a=Ot)}const ut=[...` 	
\r\f \v\uFEFF`];function Ft(e,t,i){var a=e==null?"":""+e;if(i){for(var l in i)if(i[l])a=a?a+" "+l:l;else if(a.length)for(var d=l.length,u=0;(u=a.indexOf(l,u))>=0;){var m=u+d;(u===0||ut.includes(a[u-1]))&&(m===a.length||ut.includes(a[m]))?a=(u===0?"":a.substring(0,u))+a.substring(m+1):u=m}}return a===""?null:a}function qt(e,t){return e==null?null:String(e)}function Ht(e,t,i,a,l,d){var u=e.__className;if(nt||u!==i){var m=Ft(i,a,d);(!nt||m!==e.getAttribute("class"))&&(m==null?e.removeAttribute("class"):t?e.className=m:e.setAttribute("class",m)),e.__className=i}else if(d&&l!==d)for(var v in d){var w=!!d[v];(l==null||w!==!!l[v])&&e.classList.toggle(v,w)}return d}var N,O;class Tt{constructor(){r(this,N,h(n([])));r(this,O,h(null));S(this,"lastTimestamp",0)}get gamepads(){return o(s(this,N))}set gamepads(t){c(s(this,N),n(t))}get current(){return o(s(this,O))}set current(t){c(s(this,O),n(t))}updateGamepads(){this.gamepads=navigator.getGamepads?Array.from(navigator.getGamepads()).filter(t=>t):[],this.gamepads.length?(this.current=this.gamepads[0],this.lastTimestamp<this.current.timestamp&&(console.log("Update: ",this.current),this.lastTimestamp=this.current.timestamp)):this.current=null}getPS4ButtonLabel(t){return{0:"✕",1:"◯",2:"◻",3:"△",4:"L1",5:"R1",6:"L2",7:"R2",8:"Share",9:"Options",10:"L3",11:"R3",12:"D-Pad Up",13:"D-Pad Down",14:"D-Pad Left",15:"D-Pad Right",16:"PS",17:"Touchpad"}[t]||`B${t}`}}N=new WeakMap,O=new WeakMap;const kt={lines:[],rectangles:[],circles:[]};var A;class It{constructor(){S(this,"socket",null);S(this,"url",`ws://${window.location.hostname}:8002`);S(this,"messageHandlers",{});S(this,"reconnectInterval",1e3);S(this,"messageQueue",[]);r(this,A,h("closed"));this.messageQueue=[],this.messageHandlers={}}get state(){return o(s(this,A))}set state(t){c(s(this,A),n(t))}init(){return console.log("ran init"),new Promise((t,i)=>{this.socket||(this.socket=new WebSocket(this.url),this.socket.onopen=()=>{this.state="opened",console.log("Connected to WebSocket."),t(),this.flushQueue()},this.socket.onmessage=a=>{const l=JSON.parse(a.data),d=l.kind;d!="time"&&console.log(l),this.handleMessage(d,l)},this.socket.onerror=a=>{console.error("WebSocket error:",a),i(a)},this.socket.onclose=()=>{this.state="closed",console.log("WebSocket closed. Attempting to reconnect..."),setTimeout(async()=>await this.reconnect(),this.reconnectInterval)})})}async reconnect(){this.state=="closed"&&(console.log("Reconnecting..."),this.socket=null,await this.init())}sendMessage(t){this.socket&&this.socket.readyState===WebSocket.OPEN?this.socket.send(JSON.stringify(t)):(console.warn("WebSocket not open. Queuing message."),this.messageQueue.push(JSON.stringify(t)))}flushQueue(){var t;for(;this.messageQueue.length>0&&((t=this.socket)==null?void 0:t.readyState)===WebSocket.OPEN;)this.socket.send(this.messageQueue.shift())}handleMessage(t,i){const a=this.messageHandlers[t];a?a(i):console.warn(`No handler for message kind: ${t}`)}addMessageHandler(t,i){this.messageHandlers[t]=i}removeMessageHandler(t){delete this.messageHandlers[t]}}A=new WeakMap;var R,b,E,P,F,H,T,k,I,L,D,G,V,W,U,Z,tt,et,st,j,it,x,C,J,Q,B,_,$;class Lt{constructor(){r(this,R,h(n([])));r(this,b,h(!1));r(this,E,h(!1));r(this,P,h(""));r(this,F,h(n([])));r(this,H,h("$Stop$Robot$"));r(this,T,h("stopped"));r(this,k,h(n([])));r(this,I,h(n(kt)));r(this,L,h(n({})));r(this,D,h(2));r(this,G,h(!1));r(this,V,h(!1));r(this,W,h(!1));r(this,U,h(n([])));r(this,Z,y(()=>this.history.length>0));r(this,tt,y(()=>{var t;return((t=this.history.at(0))==null?void 0:t.timestamp)||0}));r(this,et,y(()=>{var t;return((t=this.history.at(this.history.length-1))==null?void 0:t.timestamp)||0}));r(this,st,y(()=>this.endTimestamp-this.startTimestamp));r(this,j,h(0));r(this,it,y(()=>{var t=0,i=0;for(const a of this.history){if(a.timestamp<=this.timestamp+this.startTimestamp)t=i;else return this.history.at(t);i++}return this.history.at(this.history.length-1)||null}));r(this,x,h(n([])));r(this,C,h(n(new Map)));r(this,J,h(n({})));r(this,Q,h(""));r(this,B,h("NORMAL"));r(this,_,h(-1));r(this,$,h(n([])))}get plugins(){return o(s(this,R))}set plugins(t){c(s(this,R),n(t))}get showSettings(){return o(s(this,b))}set showSettings(t){c(s(this,b),n(t))}get showEdit(){return o(s(this,E))}set showEdit(t){c(s(this,E),n(t))}get time(){return o(s(this,P))}set time(t){c(s(this,P),n(t))}get opModes(){return o(s(this,F))}set opModes(t){c(s(this,F),n(t))}get activeOpMode(){return o(s(this,H))}set activeOpMode(t){c(s(this,H),n(t))}get activeOpModeStatus(){return o(s(this,T))}set activeOpModeStatus(t){c(s(this,T),n(t))}get telemetry(){return o(s(this,k))}set telemetry(t){c(s(this,k),n(t))}get canvas(){return o(s(this,I))}set canvas(t){c(s(this,I),n(t))}get graphs(){return o(s(this,L))}set graphs(t){c(s(this,L),n(t))}get timeWindow(){return o(s(this,D))}set timeWindow(t){c(s(this,D),n(t))}get isRecording(){return o(s(this,G))}set isRecording(t){c(s(this,G),n(t))}get isPlaying(){return o(s(this,V))}set isPlaying(t){c(s(this,V),n(t))}get isForwarding(){return o(s(this,W))}set isForwarding(t){c(s(this,W),n(t))}get history(){return o(s(this,U))}set history(t){c(s(this,U),n(t))}get hasRecording(){return o(s(this,Z))}get startTimestamp(){return o(s(this,tt))}get endTimestamp(){return o(s(this,et))}get duration(){return o(s(this,st))}get timestamp(){return o(s(this,j))}set timestamp(t){c(s(this,j),n(t))}get entry(){return o(s(this,it))}loop(){this.isPlaying&&this.entry!=null&&(this.telemetry=this.entry.lines,this.canvas=this.entry.canvas,this.graphs=this.entry.graphs)}get jvmFields(){return o(s(this,x))}set jvmFields(t){c(s(this,x),n(t))}get initialJvmFields(){return o(s(this,C))}set initialJvmFields(t){c(s(this,C),n(t))}get openedStates(){return o(s(this,J))}set openedStates(t){c(s(this,J),n(t))}get searchParam(){return o(s(this,Q))}set searchParam(t){c(s(this,Q),n(t))}get configurablesState(){return o(s(this,B))}set configurablesState(t){c(s(this,B),n(t))}get batteryVoltage(){return o(s(this,_))}set batteryVoltage(t){c(s(this,_),n(t))}get flows(){return o(s(this,$))}set flows(t){c(s(this,$),n(t))}}R=new WeakMap,b=new WeakMap,E=new WeakMap,P=new WeakMap,F=new WeakMap,H=new WeakMap,T=new WeakMap,k=new WeakMap,I=new WeakMap,L=new WeakMap,D=new WeakMap,G=new WeakMap,V=new WeakMap,W=new WeakMap,U=new WeakMap,Z=new WeakMap,tt=new WeakMap,et=new WeakMap,st=new WeakMap,j=new WeakMap,it=new WeakMap,x=new WeakMap,C=new WeakMap,J=new WeakMap,Q=new WeakMap,B=new WeakMap,_=new WeakMap,$=new WeakMap;var Dt=(e=>(e.NORMAL="NORMAL",e.SEARCH="SEARCH",e.DIFF="DIFF",e))(Dt||{}),Y;class Gt{constructor(){r(this,Y,h(n([])))}get data(){return o(s(this,Y))}set data(t){c(s(this,Y),n(t))}add(t){this.data.push({timestamp:Date.now(),text:t})}}Y=new WeakMap;var M=(e=>(e.INT="INT",e.DOUBLE="DOUBLE",e.STRING="STRING",e.BOOLEAN="BOOLEAN",e.FLOAT="FLOAT",e.LONG="LONG",e.ENUM="ENUM",e.ARRAY="ARRAY",e.LIST="LIST",e.UNKNOWN="UNKNOWN",e.CUSTOM="CUSTOM",e.MAP="MAP",e.GENERIC="GENERIC",e.GENERIC_NO_ANNOTATION="GENERIC_NO_ANNOTATION",e))(M||{});function at(e,t,i){for(const a of e)(a.type==M.CUSTOM||a.type==M.ARRAY||a.type==M.MAP||a.type==M.LIST)&&Array.isArray(a.customValues)?(i(a),at(a.customValues,t,i)):t(a)}function Vt(e,t,i){return e.map(a=>{if((a.type===M.CUSTOM||a.type===M.ARRAY||a.type===M.MAP||a.type===M.LIST)&&Array.isArray(a.customValues)){const l=Vt(a.customValues,t,i);return i(a,l)}else return t(a)})}const f=new It;f.addMessageHandler("time",e=>{g.time=e.time});f.addMessageHandler("opmodes",e=>{g.opModes=e.opModes});f.addMessageHandler("activeOpMode",e=>{g.activeOpMode=e.opMode.name,g.activeOpModeStatus=e.status});const g=new Lt;f.addMessageHandler("telemetryPacket",e=>{const a=new Date(e.timestamp).getTime()-g.timeWindow*1e3,l={};for(const[d,u]of Object.entries(e.graphs)){const m=u.filter(p=>new Date(p.timestamp).getTime()>=a),v=m.length;if(v<=1200){l[d]=m;continue}const w=(v-1)/1199,K=[];for(let p=0;p<1200;p++){const q=Math.round(p*w);K.push(m[q])}l[d]=K}g.isPlaying||(g.telemetry=e.lines,g.canvas=e.canvas,g.graphs=l),g.isRecording&&g.history.push({canvas:e.canvas,lines:e.lines,graphs:l,timestamp:e.timestamp})});f.addMessageHandler("jvmFields",e=>{g.jvmFields=e.fields;const t=i=>{i.isShown=!0};at(g.jvmFields,t,t)});f.addMessageHandler("initialJvmFields",e=>{const t=e.fields,i=new Map;function a(l){i.set(l.id,l.valueString)}at(t,a,a),g.initialJvmFields=i});f.addMessageHandler("updatedJvmFields",e=>{at(g.jvmFields,t=>{for(const i of e.fields)t.id==i.id&&(t.valueString=i.newValueString,t.valueString=i.newValueString,t.value=i.newValueString,t.isValid=!0)},t=>{})});f.addMessageHandler("batteryVoltage",e=>{g.batteryVoltage=e.value});f.addMessageHandler("allFlows",e=>{g.flows=e.flows});f.addMessageHandler("plugins",e=>{g.plugins=e.plugins});const zt=new Tt,Xt=new Gt;var Wt=lt('<div class="header svelte-h3jx70"><!></div>');function Ut(e,t){var i=Wt(),a=rt(i);ht(a,()=>t.children),ot(i),X(e,i)}var jt=lt('<h2 class="svelte-opkjd0"><!></h2>');function xt(e,t){var i=jt(),a=rt(i);ht(a,()=>t.children),ot(i),X(e,i)}var Ct=lt("<section><!> <!></section>");function Zt(e,t){let i=z(t,"title",3,""),a=z(t,"maxHeight",3,!1),l=z(t,"isDisabled",3,!1),d=z(t,"isPrimary",3,!1);var u=Ct();let m;var v=rt(u);{var w=p=>{Ut(p,{children:(q,Jt)=>{xt(q,{children:(pt,Qt)=>{Rt();var ct=Et();gt(()=>Pt(ct,i())),X(pt,ct)}})}})};bt(v,p=>{i()!=""&&p(w)})}var K=At(v,2);ht(K,()=>t.children??mt),ot(u),gt(p=>m=Ht(u,1,"svelte-amh5x5",null,m,p),[()=>({maxHeight:a(),isDisabled:l(),isPrimary:d()})]),X(e,u)}export{Dt as C,Ut as H,Zt as S,M as T,Ht as a,f as b,xt as c,at as d,Vt as f,zt as g,g as i,Xt as n,ht as s,qt as t};
