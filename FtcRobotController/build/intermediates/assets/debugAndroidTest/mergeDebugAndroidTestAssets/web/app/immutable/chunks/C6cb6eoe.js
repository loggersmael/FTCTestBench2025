var pt=Object.defineProperty;var ct=e=>{throw TypeError(e)};var ft=(e,t,s)=>t in e?pt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var w=(e,t,s)=>ft(e,typeof t!="symbol"?t+"":t,s),vt=(e,t,s)=>t.has(e)||ct("Cannot "+s);var i=(e,t,s)=>(vt(e,t,"read from private field"),s?s.call(e):t.get(e)),n=(e,t,s)=>t.has(e)?ct("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s);import{B as St,af as wt,O as Mt,a5 as ut,a2 as yt,h as at,J as Nt,aE as h,o,a8 as c,w as y,d as rt,i as nt,t as dt,s as Ot,aH as At}from"./DLBbvs7e.js";import{a as r,p as q,i as Rt}from"./Bs98DhGR.js";import{t as ot,b as z,e as bt}from"./AckLZTS8.js";import{s as Et}from"./CkUz7bwT.js";function lt(e,t,...s){var a=e,l=ut,d;St(()=>{l!==(l=t())&&(d&&(yt(d),d=null),d=Mt(()=>l(a,...s)))},wt),at&&(a=Nt)}const gt=[...` 	
\r\f \v\uFEFF`];function Pt(e,t,s){var a=e==null?"":""+e;if(s){for(var l in s)if(s[l])a=a?a+" "+l:l;else if(a.length)for(var d=l.length,g=0;(g=a.indexOf(l,g))>=0;){var m=g+d;(g===0||gt.includes(a[g-1]))&&(m===a.length||gt.includes(a[m]))?a=(g===0?"":a.substring(0,g))+a.substring(m+1):g=m}}return a===""?null:a}function Kt(e,t){return e==null?null:String(e)}function Ft(e,t,s,a,l,d){var g=e.__className;if(at||g!==s){var m=Pt(s,a,d);(!at||m!==e.getAttribute("class"))&&(m==null?e.removeAttribute("class"):t?e.className=m:e.setAttribute("class",m)),e.__className=s}else if(d&&l!==d)for(var f in d){var M=!!d[f];(l==null||M!==!!l[f])&&e.classList.toggle(f,M)}return d}var N,O;class Tt{constructor(){n(this,N,h(r([])));n(this,O,h(null));w(this,"lastTimestamp",0)}get gamepads(){return o(i(this,N))}set gamepads(t){c(i(this,N),r(t))}get current(){return o(i(this,O))}set current(t){c(i(this,O),r(t))}updateGamepads(){this.gamepads=navigator.getGamepads?Array.from(navigator.getGamepads()).filter(t=>t):[],this.gamepads.length?(this.current=this.gamepads[0],this.lastTimestamp<this.current.timestamp&&(console.log("Update: ",this.current),this.lastTimestamp=this.current.timestamp)):this.current=null}getPS4ButtonLabel(t){return{0:"✕",1:"◯",2:"◻",3:"△",4:"L1",5:"R1",6:"L2",7:"R2",8:"Share",9:"Options",10:"L3",11:"R3",12:"D-Pad Up",13:"D-Pad Down",14:"D-Pad Left",15:"D-Pad Right",16:"PS",17:"Touchpad"}[t]||`B${t}`}}N=new WeakMap,O=new WeakMap;const Ht={lines:[],rectangles:[],circles:[]};var A;class kt{constructor(){w(this,"socket",null);w(this,"url",`ws://${window.location.hostname}:8002`);w(this,"messageHandlers",{});w(this,"reconnectInterval",1e3);w(this,"messageQueue",[]);n(this,A,h("closed"));this.messageQueue=[],this.messageHandlers={}}get state(){return o(i(this,A))}set state(t){c(i(this,A),r(t))}init(){return console.log("ran init"),new Promise((t,s)=>{this.socket||(this.socket=new WebSocket(this.url),this.socket.onopen=()=>{this.state="opened",console.log("Connected to WebSocket."),t(),this.flushQueue()},this.socket.onmessage=a=>{const l=JSON.parse(a.data),d=l.kind;d!="time"&&console.log(l),this.handleMessage(d,l)},this.socket.onerror=a=>{console.error("WebSocket error:",a),s(a)},this.socket.onclose=()=>{this.state="closed",console.log("WebSocket closed. Attempting to reconnect..."),setTimeout(async()=>await this.reconnect(),this.reconnectInterval)})})}async reconnect(){this.state=="closed"&&(console.log("Reconnecting..."),this.socket=null,await this.init())}sendMessage(t){this.socket&&this.socket.readyState===WebSocket.OPEN?this.socket.send(JSON.stringify(t)):(console.warn("WebSocket not open. Queuing message."),this.messageQueue.push(JSON.stringify(t)))}flushQueue(){var t;for(;this.messageQueue.length>0&&((t=this.socket)==null?void 0:t.readyState)===WebSocket.OPEN;)this.socket.send(this.messageQueue.shift())}handleMessage(t,s){const a=this.messageHandlers[t];a?a(s):console.warn(`No handler for message kind: ${t}`)}addMessageHandler(t,s){this.messageHandlers[t]=s}removeMessageHandler(t){delete this.messageHandlers[t]}}A=new WeakMap;var R,b,E,P,F,T,H,k,I,L,D,G,V,W,X,Z,tt,et,U,st,j,x,C,J,Q,B,_;class It{constructor(){n(this,R,h(!1));n(this,b,h(!1));n(this,E,h(""));n(this,P,h(r([])));n(this,F,h("$Stop$Robot$"));n(this,T,h("stopped"));n(this,H,h(r([])));n(this,k,h(r(Ht)));n(this,I,h(r({})));n(this,L,h(2));n(this,D,h(!1));n(this,G,h(!1));n(this,V,h(!1));n(this,W,h(r([])));n(this,X,y(()=>this.history.length>0));n(this,Z,y(()=>{var t;return((t=this.history.at(0))==null?void 0:t.timestamp)||0}));n(this,tt,y(()=>{var t;return((t=this.history.at(this.history.length-1))==null?void 0:t.timestamp)||0}));n(this,et,y(()=>this.endTimestamp-this.startTimestamp));n(this,U,h(0));n(this,st,y(()=>{var t=0,s=0;for(const a of this.history){if(a.timestamp<=this.timestamp+this.startTimestamp)t=s;else return this.history.at(t);s++}return this.history.at(this.history.length-1)||null}));n(this,j,h(r([])));n(this,x,h(r(new Map)));n(this,C,h(r({})));n(this,J,h(""));n(this,Q,h("NORMAL"));n(this,B,h(-1));n(this,_,h(r([])))}get showSettings(){return o(i(this,R))}set showSettings(t){c(i(this,R),r(t))}get showEdit(){return o(i(this,b))}set showEdit(t){c(i(this,b),r(t))}get time(){return o(i(this,E))}set time(t){c(i(this,E),r(t))}get opModes(){return o(i(this,P))}set opModes(t){c(i(this,P),r(t))}get activeOpMode(){return o(i(this,F))}set activeOpMode(t){c(i(this,F),r(t))}get activeOpModeStatus(){return o(i(this,T))}set activeOpModeStatus(t){c(i(this,T),r(t))}get telemetry(){return o(i(this,H))}set telemetry(t){c(i(this,H),r(t))}get canvas(){return o(i(this,k))}set canvas(t){c(i(this,k),r(t))}get graphs(){return o(i(this,I))}set graphs(t){c(i(this,I),r(t))}get timeWindow(){return o(i(this,L))}set timeWindow(t){c(i(this,L),r(t))}get isRecording(){return o(i(this,D))}set isRecording(t){c(i(this,D),r(t))}get isPlaying(){return o(i(this,G))}set isPlaying(t){c(i(this,G),r(t))}get isForwarding(){return o(i(this,V))}set isForwarding(t){c(i(this,V),r(t))}get history(){return o(i(this,W))}set history(t){c(i(this,W),r(t))}get hasRecording(){return o(i(this,X))}get startTimestamp(){return o(i(this,Z))}get endTimestamp(){return o(i(this,tt))}get duration(){return o(i(this,et))}get timestamp(){return o(i(this,U))}set timestamp(t){c(i(this,U),r(t))}get entry(){return o(i(this,st))}loop(){this.isPlaying&&this.entry!=null&&(this.telemetry=this.entry.lines,this.canvas=this.entry.canvas,this.graphs=this.entry.graphs)}get jvmFields(){return o(i(this,j))}set jvmFields(t){c(i(this,j),r(t))}get initialJvmFields(){return o(i(this,x))}set initialJvmFields(t){c(i(this,x),r(t))}get openedStates(){return o(i(this,C))}set openedStates(t){c(i(this,C),r(t))}get searchParam(){return o(i(this,J))}set searchParam(t){c(i(this,J),r(t))}get configurablesState(){return o(i(this,Q))}set configurablesState(t){c(i(this,Q),r(t))}get batteryVoltage(){return o(i(this,B))}set batteryVoltage(t){c(i(this,B),r(t))}get flows(){return o(i(this,_))}set flows(t){c(i(this,_),r(t))}}R=new WeakMap,b=new WeakMap,E=new WeakMap,P=new WeakMap,F=new WeakMap,T=new WeakMap,H=new WeakMap,k=new WeakMap,I=new WeakMap,L=new WeakMap,D=new WeakMap,G=new WeakMap,V=new WeakMap,W=new WeakMap,X=new WeakMap,Z=new WeakMap,tt=new WeakMap,et=new WeakMap,U=new WeakMap,st=new WeakMap,j=new WeakMap,x=new WeakMap,C=new WeakMap,J=new WeakMap,Q=new WeakMap,B=new WeakMap,_=new WeakMap;var Lt=(e=>(e.NORMAL="NORMAL",e.SEARCH="SEARCH",e.DIFF="DIFF",e))(Lt||{}),$;class Dt{constructor(){n(this,$,h(r([])))}get data(){return o(i(this,$))}set data(t){c(i(this,$),r(t))}add(t){this.data.push({timestamp:Date.now(),text:t})}}$=new WeakMap;var v=(e=>(e.INT="INT",e.DOUBLE="DOUBLE",e.STRING="STRING",e.BOOLEAN="BOOLEAN",e.FLOAT="FLOAT",e.LONG="LONG",e.ENUM="ENUM",e.ARRAY="ARRAY",e.LIST="LIST",e.UNKNOWN="UNKNOWN",e.CUSTOM="CUSTOM",e.MAP="MAP",e.GENERIC="GENERIC",e.GENERIC_NO_ANNOTATION="GENERIC_NO_ANNOTATION",e))(v||{});function it(e,t,s){for(const a of e)(a.type==v.CUSTOM||a.type==v.ARRAY||a.type==v.MAP||a.type==v.LIST)&&Array.isArray(a.customValues)?(s(a),it(a.customValues,t,s)):t(a)}function Gt(e,t,s){return e.map(a=>{if((a.type===v.CUSTOM||a.type===v.ARRAY||a.type===v.MAP||a.type===v.LIST)&&Array.isArray(a.customValues)){const l=Gt(a.customValues,t,s);return s(a,l)}else return t(a)})}const S=new kt;S.addMessageHandler("time",e=>{u.time=e.time});S.addMessageHandler("opmodes",e=>{u.opModes=e.opModes});S.addMessageHandler("activeOpMode",e=>{u.activeOpMode=e.opMode.name,u.activeOpModeStatus=e.status});const u=new It;S.addMessageHandler("telemetryPacket",e=>{const a=new Date(e.timestamp).getTime()-u.timeWindow*1e3,l={};for(const[d,g]of Object.entries(e.graphs)){const m=g.filter(p=>new Date(p.timestamp).getTime()>=a),f=m.length;if(f<=1200){l[d]=m;continue}const M=(f-1)/1199,Y=[];for(let p=0;p<1200;p++){const K=Math.round(p*M);Y.push(m[K])}l[d]=Y}u.isPlaying||(u.telemetry=e.lines,u.canvas=e.canvas,u.graphs=l),u.isRecording&&u.history.push({canvas:e.canvas,lines:e.lines,graphs:l,timestamp:e.timestamp})});S.addMessageHandler("jvmFields",e=>{u.jvmFields=e.fields;const t=s=>{s.isShown=!0};it(u.jvmFields,t,t)});S.addMessageHandler("initialJvmFields",e=>{const t=e.fields,s=new Map;function a(l){s.set(l.id,l.valueString)}it(t,a,a),u.initialJvmFields=s});S.addMessageHandler("updatedJvmFields",e=>{it(u.jvmFields,t=>{for(const s of e.fields)t.id==s.id&&(t.valueString=s.newValueString,t.valueString=s.newValueString,t.value=s.newValueString,t.isValid=!0)},t=>{})});S.addMessageHandler("batteryVoltage",e=>{u.batteryVoltage=e.value});S.addMessageHandler("allFlows",e=>{u.flows=e.flows});const qt=new Tt,zt=new Dt;var Vt=ot('<div class="header svelte-h3jx70"><!></div>');function Wt(e,t){var s=Vt(),a=rt(s);lt(a,()=>t.children),nt(s),z(e,s)}var Ut=ot('<h2 class="svelte-opkjd0"><!></h2>');function jt(e,t){var s=Ut(),a=rt(s);lt(a,()=>t.children),nt(s),z(e,s)}var xt=ot("<section><!> <!></section>");function Xt(e,t){let s=q(t,"title",3,""),a=q(t,"maxHeight",3,!1),l=q(t,"isDisabled",3,!1),d=q(t,"isPrimary",3,!1);var g=xt();let m;var f=rt(g);{var M=p=>{Wt(p,{children:(K,Ct)=>{jt(K,{children:(mt,Jt)=>{At();var ht=bt();dt(()=>Et(ht,s())),z(mt,ht)}})}})};Rt(f,p=>{s()!=""&&p(M)})}var Y=Ot(f,2);lt(Y,()=>t.children??ut),nt(g),dt(p=>m=Ft(g,1,"svelte-amh5x5",null,m,p),[()=>({maxHeight:a(),isDisabled:l(),isPrimary:d()})]),z(e,g)}export{Lt as C,Wt as H,Xt as S,v as T,Ft as a,S as b,jt as c,it as d,Gt as f,qt as g,u as i,zt as n,lt as s,Kt as t};
